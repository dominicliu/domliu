skills = [
	{
		name: "AngularJS"
		image: "angular.jpg"
		rating: 3
		extras: ["Protractor"]
		links: [
			{
				name: "This website"
				link: "/"
			}
			{
				name: "Timer"
				link: "http://timer.initiatorapp.com/"
			}
		]
	}
	{
		name: "Ember.js"
		image: "ember.jpg"
		rating: 5
		extras: ["Ember Data"]
		links: [
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "CoffeeScript"
		image: "coffeescript.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "Node.js"
		image: "node.jpg"
		rating: 5
		extras: ["Express"]
		links: [
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "PHP"
		image: "php.jpg"
		rating: 5
		extras: ["Twig"]
		links: [
			{
				name: "MapleKit"
				link: "http://mk.youngmaple.ca/"
			}
		]
	}
	{
		name: "MySQL"
		image: "mysql.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "MapleKit"
				link: "http://mk.youngmaple.ca/"
			}
		]
	}
	{
		name: "MongoDB"
		image: "mongodb.jpg"
		rating: 3
		extras: ["Mongoose"]
		links: [
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "jQuery"
		image: "jquery.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "MapleKit"
				link: "http://mk.youngmaple.ca/"
			}
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "Bootstrap"
		image: "bootstrap.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
		]
	}
	{
		name: "Less"
		image: "less.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "DecisiveMe"
				link: "https://decisiveme.com/"
			}
		]
	}
	{
		name: "Graphic Design"
		image: "graphic_design.jpg"
		rating: 4
		extras: []
		links: [
			{
				name: "Logo Design"
				link: "https://www.fiverr.com/onlylakehouse/design-a-professional-logo-in-12-hours"
			}
			{
				name: "Cover Design"
				link: "https://www.fiverr.com/onlylakehouse/design-a-kindle-ebook-cover-with-psd-file-included"
			}
		]
	}
	{
		name: "Web Design"
		image: "web_design.jpg"
		rating: 3
		extras: []
		links: [
			{
				name: "This website"
				link: "/"
			}
			{
				name: "Initiator"
				link: "https://initiatorapp.com/"
			}
			{
				name: "MapleKit"
				link: "http://mk.youngmaple.ca/"
			}
		]
	}
	{
		name: "Photography"
		image: "photography.jpg"
		rating: 5
		extras: []
		links: []
	}
	{
		name: "Photoshop"
		image: "photoshop.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "Cover Design"
				link: "https://www.fiverr.com/onlylakehouse/design-a-kindle-ebook-cover-with-psd-file-included"
			}
		]
	}
	{
		name: "Illustrator"
		image: "illustrator.jpg"
		rating: 2
		extras: []
		links: [
			{
				name: "Logo Design"
				link: "https://www.fiverr.com/onlylakehouse/design-a-professional-logo-in-12-hours"
			}
		]
	}
	{
		name: "InDesign"
		image: "indesign.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "My Résumé"
				link: "/Mingxi_Liu_Résumé.pdf"
			}
		]
	}
	{
		name: "Premiere Pro"
		image: "premiere.jpg"
		rating: 5
		extras: []
		links: [
			{
				name: "Maple Style"
				link: "http://v.youku.com/v_show/id_XNDkzMDA0ODY4.html"
			}
		]
	}
	{
		name: "After Effects"
		image: "after_effects.jpg"
		rating: 3
		extras: []
		links: [
			{
				name: "Maple Style"
				link: "http://v.youku.com/v_show/id_XNDkzMDA0ODY4.html"
			}
		]
	}
	{
		name: "Cinematography"
		image: "film.jpg"
		rating: 3
		extras: []
		links: [
			{
				name: "Maple Style"
				link: "http://v.youku.com/v_show/id_XNDkzMDA0ODY4.html"
			}
		]
	}
]

works = [
	{
		name: "Stopwatch Timer"
		image: "timer.png"
		skills: ["AngularJS", "Less", "CoffeeScript", "Bootstrap", "Web Design"]
		links: [{
			name: "Website"
			link: "http://timer.initiatorapp.com/"
		}]
	}
	{
		name: "DecisiveMe Decision Making Tool"
		image: "decisiveme.png"
		skills: ["Ember.js", "Node.js", "MongoDB", "CoffeeScript", "Bootstrap"]
		links: [{
			name: "Website"
			link: "https://decisiveme.com/"
		}]
	}
	{
		name: "Initiator Project Management System"
		image: "initiator.png"
		skills: ["Ember.js", "Node.js", "MySQL", "CoffeeScript", "Bootstrap", "Web Design"]
		links: [{
			name: "Website"
			link: "https://initiatorapp.com/"
		}]
	}
	{
		name: "MapleKit Project Management System"
		image: "maplekit.png"
		skills: ["PHP", "MySQL", "jQuery", "Web Design"]
		links: [{
			name: "Website"
			link: "http://mk.youngmaple.ca/"
		}]
	}
	{
		name: "Eiffel Tower, Paris"
		image: "eiffel_tower.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "Flower on the Lake"
		image: "lake_flower.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "New Town Hall, Munich"
		image: "munich_tower.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "Road in the Sunset"
		image: "sunset_road.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "Valley in the Clouds"
		image: "valley.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "The Green Valley"
		image: "valley_2.jpg"
		skills: ["Photography", "Photoshop"]
	}
	{
		name: "Me as a Cinematographer"
		image: "cinematographer.jpg"
		skills: ["Cinematography"]
	}
	{
		name: "Maple Storm Magazine Contents"
		image: "maple_storm_contents.jpg"
		skills: ["Graphic Design", "InDesign"]
	}
	{
		name: "Maple Storm Magazine Poster"
		image: "maple_storm_poster_10.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Wallpaper"
		image: "maple_storm_universe.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Cover"
		image: "maple_strom_10.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Cover"
		image: "maple_strom_13.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Cover"
		image: "maple_strom_14.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Cover"
		image: "maple_strom_15.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
	{
		name: "Maple Storm Magazine Cover"
		image: "maple_strom_16.jpg"
		skills: ["Graphic Design", "Photoshop"]
	}
]

angular.forEach skills, (skill) ->
	skill.hasWorks = false

angular.forEach works, (work) ->
	angular.forEach work.skills, (skill) ->
		matchedSkill = _.findWhere skills,
			name: skill
		if matchedSkill
			matchedSkill.hasWorks = true

app = angular.module "app", ["ngRoute", "ngAnimate", "wu.masonry"]

app.config ["$routeProvider", "$locationProvider", ($routeProvider, $locationProvider) ->
	$routeProvider
		.when "/",
			templateUrl: "/templates/home"
			controller: "homeController"
		.when "/skills",
			templateUrl: "/templates/skills"
			controller: "skillsController"
		.when "/portfolio",
			templateUrl: "/templates/portfolio"
			controller: "portfolioController"
		.when "/contact",
			templateUrl: "/templates/contact"
			controller: "contactController"

	$locationProvider.html5Mode(true)
]

app.controller "appController", ["$scope", "$timeout", "$location", ($scope, $timeout, $location) ->
	$scope.animationActive = false

	$scope.isActive = (path) ->
		$location.path() is path
	$scope.toggleNavbar = ->
		$("button.navbar-toggle:visible").click()
		return

	$timeout ->
		$scope.animationActive = true
	, 10
]

app.controller "homeController", ["$scope", ($scope) ->
	document.title = "Home | Dominic Liu"
]

app.controller "skillsController", ["$scope", "$timeout", "$routeParams", ($scope, $timeout, $routeParams) ->
	document.title = "Skills | Dominic Liu"

	$scope.skills = []
	$scope.search = $routeParams.search or ""
	$scope.searchFilter = (skill) ->
		skill.name.toLowerCase().indexOf($scope.search.toLowerCase()) >= 0

	$timeout ->
		$scope.skills = skills
	, 50
]

app.controller "portfolioController", ["$scope", "$timeout", "$routeParams", ($scope, $timeout, $routeParams) ->
	document.title = "Portfolio | Dominic Liu"

	$scope.works = []
	$scope.search = $routeParams.search or ""
	$scope.searchFilter = (work) ->
		matchedSkills = []
		angular.forEach work.skills, (skill) ->
			@push skill if skill.toLowerCase().indexOf($scope.search.toLowerCase()) >= 0
		, matchedSkills
		matchedSkills.length or work.name.toLowerCase().indexOf($scope.search.toLowerCase()) >= 0
	$scope.currentWork = null

	$scope.images = []
	angular.forEach works, (work) ->
		@push "/images/portfolio/" + work.image
	, $scope.images

	$timeout ->
		$scope.works = works
	, 50
]

app.controller "contactController", ["$scope", ($scope) ->
	document.title = "Contact | Dominic Liu"
]

app.directive 'ngEnter', ->
	(scope, element, attrs) ->
		element.bind 'keydown keypress', (event) ->
			if event.which == 13
				scope.$apply ->
					scope.$eval attrs.ngEnter, 'event': event
				event.preventDefault()

app.directive 'ngAutoFocus', ->
	(scope, element, attrs) ->
		element[0].focus()
		element[0].selectionStart = element[0].selectionEnd = element[0].value.length # focus at the end

app.directive 'makeFocus', ($timeout) ->
	'use strict'
	(scope, elem, attrs) ->
		scope.$watch attrs.makeFocus, (newVal) ->
			if newVal
				$timeout (->
					elem[0].focus()
				), 0, false

app.directive 'starRating', ->
	{
		restrict: 'EA'
		template: '<ul class=\'rating\' ng-class=\'{readonly: readonly}\'>
						<li ng-repeat=\'star in stars\' ng-class=\'star\' ng-click=\'toggle($index)\'>
							<i class=\'fa fa-star\'></i>
						</li>
					</ul>'
		scope:
			ratingValue: '=ngModel'
			max: '=?'
			onRatingSelected: '&?'
			readonly: '=?'
		link: (scope, elem, attrs) ->

			updateStars = ->
				scope.stars = []
				i = 0
				while i < scope.max
					scope.stars.push filled: i < scope.ratingValue
					i++
				return

			if scope.max == undefined
				scope.max = 5

			scope.toggle = (index) ->
				if scope.readonly == undefined or scope.readonly == false
					scope.ratingValue = index + 1
					scope.onRatingSelected rating: index + 1

			scope.$watch 'ratingValue', (oldVal, newVal) ->
				if newVal
					updateStars()

	}